<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>SpecialSub - RTFM</title>

    <meta http-equiv="Content-Language" content="en-GB">
    <meta http-equiv="Window-target" content="_top">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
    <meta http-equiv="X-Soup-Of-The-Day" content="Tomato">

    <meta name="author" content="Kevin Walsh">
    <meta name="publisher" content="Cursor Software Limited">
    <meta name="copyright" content="2001-2015, Cursor Software Limited">
    <meta name="licence" content="GPLv2+ (Unknown licence)">
    <meta name="generator" content="Interchange 5.7.0 -- www.icdevgroup.org">
    <meta name="robots" content="index,follow,noarchive,noimageindex">
    <meta name="keywords" content="Interchange, Interchange Help, Interchange Support, Interchange Documentation, Interchange Downloads, Interchange Resources">
    <meta name="description" content="Interchange, Interchange Help, Interchange Support, Interchange Documentation, Interchange Downloads, Interchange Resources">
    <meta name="MSSmartTagsPreventParsing" content="TRUE">

    <meta name="verify-v1" content="KqlU/bxZj9Y2ZdZ/3RwuzgVSMIrZ8XM2wqbjSaEo3O4=">

    <meta name="y_key" content="e2dd60be5777fbc8">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" type="image/png">
    <link rel="search" type="application/opensearchdescription+xml" href="http://interchange-rtfm.pullingshots.ca/cms/mozilla_search_plugin.xml" title="Interchange RTFM website">
    <link rel="stylesheet" href="/decor/css/website.css">
    <link rel="stylesheet" href="/decor/css/wiki.css">
    <link rel="stylesheet" href="/decor/css/neo.css">


    <script type="text/javascript" language="JavaScript">
    <!--
	if (top != self){
	    top.location = location;
	}

    // -->
    </script>
</head>
<body>
<!-- START VAR: LOGOBAR -->
<table id="rtfmheader" cellpadding="0" cellspacing="0">
    <tr>
	<td><a href="http://interchange-rtfm.pullingshots.ca/index.html" title="For more information... RTFM!"><img src="/decor/images/rtfm_banner.gif" width="500" height="60" border="0" alt="For more information... RTFM!"></a></td>

	<td width="100%" style="text-align: right; padding: 10px">

	    <form action="http://interchange-rtfm.pullingshots.ca/search.html" method="POST">
		<input type="hidden" name="mv_session_id" value="nsession">
		<input type="hidden" name="mv_profile" value="cms_search">
		<input name="mv_searchspec" value="" type="text" size="15" maxlength="100" class="search">
		<input type="submit" class="button" value="Search">
	    </form>

	</td>
    </tr>
</table>
<table id="breadcrumbs" cellpadding="0" cellspacing="0">
    <tr valign="top">
	<td>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/documentation.html">Documentation</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/index.html">Latest documentation</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/category:Local_config_directives.html">Local config directives</a></span>
	    <span class="nowrap">&gt; <span class="current">SpecialSub</span></span>
	</td>

    </tr>
</table>
<!-- END VAR: LOGOBAR -->

    <table width="100%" cellpadding="0" cellspacing="0" border="0">
	<tr valign="top">

	    <td id="leftside">
<!-- START COMPONENT: navigation -->

<table class="component" cellpadding="0" cellspacing="0">
    <tr>
	<th>NAVIGATION</th>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/documentation.html">Documentation</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/downloads.html">Downloads</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/community.html">Mail lists and IRC</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/links.html">External websites</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/contributions.html">Suggestions and contributions</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/usermap.html">User location map</a></li>
	    </ul>
	</td>
    </tr>
</table>



<!-- END COMPONENT: navigation -->
<!-- START COMPONENT: wiki_recent -->



<!-- END COMPONENT: wiki_recent -->
<!-- START COMPONENT: wiki_backlinks -->

<table class="component" cellpadding="0" cellspacing="0">
    <tr>
	<th><span class="nowrap">PAGES THAT LINK HERE</span></th>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/RobotLimit.html">RobotLimit</a></li>
	    </ul>
	</td>
    </tr>
</table>


<!-- END COMPONENT: wiki_backlinks -->
<!-- START COMPONENT: account -->

<table class="component" cellpadding="0" cellspacing="0">

    <tr>
	<th>ACCOUNT LOGIN</th>
    </tr>

    <tr>
	<td class="first">
	    <p>You are not logged in</p>
	</td>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/login.html">Log in</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/create.html">Create an account</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/reminder.html">Password reminder</a></li>
	    </ul>
	</td>
    </tr>

</table>



<!-- END COMPONENT: account -->
<!-- START COMPONENT: icpowered -->

<div style="text-align: center; margin: 10px; margin-top: 0px">
    <a href="http://interchange-rtfm.pullingshots.ca/bouncer.html?target=http%3a%2f%2fwww%2eicdevgroup%2eorg%2f" title="Powered by Interchange version 5.7.0"><img src="/decor/images/iclogo_button.gif" width="136" height="44" alt="Powered by Interchange version 5.7.0"></a>
</div>



<!-- START COMPONENT: icpowered -->

	    </td>

	    <td id="bodytext">
<!-- start of page text -->

<!-- start page: wiki/display (config/SpecialSub) -->

<div class="wikitext">
<a name="SpecialSub"></a>
<h1>SpecialSub</h1>
<p>
Specify specify subroutines that should be called to handle certain events.
</p>
<a name="Synopsis"></a>
<h2>Synopsis</h2>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; event&nbsp; subroutine</span><span class="def_Symbol">_</span>name
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
You can specify subroutines for multiple events at once
by using the Perl-style &quot;here document&quot; syntax,
as follows:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
&nbsp; &nbsp; event1&nbsp; <span class="def_Syntax">subroutine</span><span class="def_Symbol">_</span>name1<br>
&nbsp; &nbsp; event2&nbsp; <span class="def_Syntax">subroutine</span><span class="def_Symbol">_</span>name2<br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Scope"></a>
<h2>Scope</h2>
<p>
<!-- start of nosearch block -->
This directive is only available for use in the <em>local</em>
(<span class="fixedwidth">catalog.cfg</span>) configuration file.&nbsp;
It will not affect any other website in any way.&nbsp;
This directive will not work in the <em>global</em>
(<span class="fixedwidth">interchange.cfg</span>) configuration file.&nbsp;
<!-- end of nosearch block -->
<a name="Description"></a>
<h2>Description</h2>
<p>
This directive is used to specify <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/Sub.html" title="Sub (config)">Sub</a></span> or
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/GlobalSub.html" title="GlobalSub (config)">GlobalSub</a></span> subroutines that will be called to
handle certain events.&nbsp;
Individual subroutines can be defined to handle the following events:
</p>
<table class="border">
<tr valign="top">
<th class="grid">Event
</th>
<th class="grid">Description
</th>
<th class="grid">Versions
</th>
</tr>
<tr valign="top">
<td class="grid">admin_init
</td>
<td class="grid">If the user has administrator privileges then this subroutine will
be called after &quot;<span class="fixedwidth">catalog_init</span>&quot; (if defined),
after session assignment
and after all of the <a href="http://interchange-rtfm.pullingshots.ca/icdocs/Interchange_Perl_objects.html" title="Interchange Perl objects">Interchange Perl objects</a> have been set up
and initialised.&nbsp;
This could,
for instance,
allow you to gain access to admin facilities,
based upon user names or groups etc.</td>
<td class="grid">5.5.0+
</td>
</tr>
<tr valign="top">
<td class="grid">debug_qualify
</td>
<td class="grid">This subroutine (if defined) will be called to decide whether
a debug message should be either logged to the
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/DebugFile.html" title="DebugFile (config)">DebugFile</a></span> or simply ignored.&nbsp;
The &quot;<span class="fixedwidth">debug_qualify</span>&quot; subroutine will only be called if the
visitor's IP address is found in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/DebugHost.html" title="DebugHost (config)">DebugHost</a></span> list,
or no such list of IP addresses has been declared.&nbsp;
If the &quot;<span class="fixedwidth">debug_qualify</span>&quot; subroutine returns a <em>true</em> value
then the debug message will be logged.</td>
<td class="grid">5.5.0+
</td>
</tr>
<tr valign="top">
<td class="grid">flypage
</td>
<td class="grid"><p>
This event is triggered just before each <em>flypage</em> is displayed.&nbsp;
The page name is provided to the given subroutine to be qualified or
modified.&nbsp;
The subroutine is expected to return a single SKU value for use on
the subsequent <em>flypage</em>.&nbsp;
See the <a href="#Handling_the_flypage_event" title="&quot;Handling the flypage event&quot; heading on this page">example</a>,
below.&nbsp;
The subroutine could also be used to set
<a href="http://interchange-rtfm.pullingshots.ca/icdocs/Interchange_Perl_objects.html#Scratch" title="&quot;Scratch&quot; heading on the &quot;Interchange Perl objects&quot; page">scratchpad</a> and/or
<a href="http://interchange-rtfm.pullingshots.ca/icdocs/Interchange_Perl_objects.html#CGI" title="&quot;CGI&quot; heading on the &quot;Interchange Perl objects&quot; page">CGI</a> values etc.,
of course.
</p>
<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_availability.gif" width="32" height="32" border="0" alt="API change">
</td>
<td width="100%">
<p class="title">API change</p>
<p style="margin-bottom: 0px">
From its introduction in version 5.3.2,
right up to version 5.5.2, the return value from this
event's subroutine was expected to look like the following:
</p>
<!-- start of code block -->
<div class="code">
<table class="light">
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span> </span>mv_results <span class="perl_Symb def_Symbol">=</span><span class="perl_Symb def_Symbol">&gt; </span><span class="def_Symbol"><span class="def_PairStart def_Special">[</span></span><span class="def_Symbol"><span class="def_PairStart def_Special">[</span> </span><span class="perl_Var def_Var">$sku </span><span class="def_Symbol"><span class="def_PairEnd def_Special">]</span></span><span class="def_Symbol"><span class="def_PairEnd def_Special">]</span> </span><span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span>
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p style="margin-bottom: 0px">
The API was changed in version 5.5.2 to allow the subroutine
the choice of returning the above hashref or just a scalar
containing the SKU value.&nbsp;
The <a href="#Handling_the_flypage_event" title="&quot;Handling the flypage event&quot; heading on this page">example</a>,
below,
uses the simpler scalar return value.
</p>
</td>
</tr>
</table></td>
<td class="grid">5.3.2+
</td>
</tr>
<tr valign="top">
<td class="grid">guess_cc_type
</td>
<td class="grid">This event is triggered when the &quot;<span class="fixedwidth">mv_credit_card_type</span>&quot; is derived.&nbsp;
Interchange recognises major card types but you might find that you need more.&nbsp;
The subroutine is called with the credit card number.&nbsp;
The return value should either be a type name, or a <em>false</em> value.&nbsp;
A <em>false</em> return value will be taken to mean that Interchange should
proceed with its built-in card type detection algorithm.</td>
<td class="grid">All
</td>
</tr>
<tr valign="top">
<td class="grid">init_session
</td>
<td class="grid">This event is triggered every time a new session is created.&nbsp;
The subroutine is called with a reference to the newly created session
hash.&nbsp;
You may add, remove or modify session values as you see fit,
but you must fully understand what you are doing before you start
monkeying about in there.&nbsp;
The subroutine's return value will be ignored.</td>
<td class="grid">All
</td>
</tr>
<tr valign="top">
<td class="grid">lockout
</td>
<td class="grid">This event allows you to run custom code during the <em>bad robot</em>
lockout procedure (see the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/RobotLimit.html" title="RobotLimit (config)">RobotLimit</a></span> <em>local</em>
configuration directive).&nbsp;
The subroutine is called without parameters.&nbsp;
If the subroutine returns <em>true</em> then the standard
(<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/LockoutCommand.html" class="nopage" title="LockoutCommand (config)">LockoutCommand</a></span>) lockout procedure
will be skipped, otherwise the standard lockout procedure
will run as usual.</td>
<td class="grid">All
</td>
</tr>
<tr valign="top">
<td class="grid">missing
</td>
<td class="grid">This Event is triggered when a requested Interchange page is missing.&nbsp;
The subroutine is called with the name of the missing page.&nbsp;
A <em>false</em> return value from the subroutine will instruct Interchange
to continue executing the default, built-in, action.&nbsp;
A <em>true</em> return value will indicate that all actions (including the
response to the client) have been performed by the custom subroutine,
and so the default action should not be executed.&nbsp;
Optionally,
the subroutine can return an array consisting of a <em>true</em> value
and the name of a page that should to be displayed to the user.</td>
<td class="grid">All
</td>
</tr>
<tr valign="top">
<td class="grid">order_missing
</td>
<td class="grid">This event is triggered on an attempt to order a non-existent sku or variant
code.&nbsp;
This subroutine is called with the invalid item code and quantity of
the order attempt.&nbsp;
A <em>false</em> return value from the subroutine will
instruct Interchange to log the failed attempt as per normal to the error log.&nbsp;
A <em>true</em> return value will suppress the error log message.</td>
<td class="grid">5.7.2+
</td>
</tr>
<tr valign="top">
<td class="grid">request_init
<br><span style="white-space: nowrap"><em>(was catalog_init)</em></span></td>
<td class="grid"><p style="margin-bottom: 0px">
This subroutine is called upon the receipt of every page request,
and before any session assignment or creation is performed.&nbsp;
The subroutine's return value is ignored.
</p>
<br>
<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_availability.gif" width="32" height="32" border="0" alt="Name change">
</td>
<td width="100%">
<p class="title">Name change</p>
<p style="margin-bottom: 0px">
This subroutine was named &quot;<span class="fixedwidth">catalog_init</span>&quot; when it was introduced
in version 5.5.0.&nbsp;
It was renamed as &quot;<span class="fixedwidth">request_init</span>&quot; in version 5.5.2
to make way for a new &quot;<span class="fixedwidth">catalog_init</span>&quot; event which,
when it is introduced in the future,
will have an entirely different purpose.
</p>
</td>
</tr>
</table></td>
<td class="grid">5.5.0+
</td>
</tr>
<tr valign="top">
<td class="grid">user_merge
</td>
<td class="grid">This event is triggered from the &#91;user-merge] UI tag on each user that is merged
into the target user.&nbsp;
You can use this event to perform additional tasks during
the merge such as copy some of the userdb data over from one user to the other or
update additional tables in the database.&nbsp;
<br><br>
The arguments passed to this subroutine
are:&nbsp;
(&#36;from_user, &#36;from_urec, &#36;to_user, &#36;to_urec, &#36;udb, &#36;tdb).&nbsp;
&#36;from_user and
&#36;to_user are the source and target usernames respectively.&nbsp;
&#36;from_urec and &#36;to_urec
are the source and target user records fetched from the userdb table with the
&#36;db-&gt;row_hash() method.&nbsp;
&#36;udb and &#36;tdb are the userdb and transactions &#36;db objects
respectively.&nbsp;
<br><br>
The subroutine should return true if no further processing of the merge is to take
place.&nbsp;
If the subroutine returns false then the rest of the merge is performed as
per usual.&nbsp;
Any changes made to &#36;to_urec will also be saved back to the userdb if
the subroutine returns false so it is not necessary to save those changes yourself.</td>
<td class="grid">5.7.2+
</td>
</tr>
</table>

<p style="margin-bottom: 0px">
<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_availability.gif" width="32" height="32" border="0" alt="Availability">
</td>
<td width="100%">
<p class="title">Availability</p>
<p style="margin-bottom: 0px">
&quot;All versions&quot; refers to Interchange 5.0.0 and above,
as 5.0.0 is the baseline for the documentation on
this website.&nbsp;
Most of the events marked &quot;All&quot; were available long before
version 5.0.0 was released.
</p>
</td>
</tr>
</table>
<a name="Examples"></a>
<h2>Examples</h2>
<a name="Handling_the_admin_init_event"></a>
<h3>Handling the &quot;admin_init&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; admin</span><span class="def_Symbol">_</span><span class="def_Syntax">init&nbsp; on</span><span class="def_Symbol">_</span><span class="def_Syntax">admin</span><span class="def_Symbol">_</span>init<br>
<br>
<span class="def_Syntax">Sub on</span><span class="def_Symbol">_</span><span class="def_Syntax">admin</span><span class="def_Symbol">_</span><span class="def_Syntax">init </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">if </span><span class="def_Symbol">(</span>$<span class="def_Syntax">Session</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">username</span><span class="def_Symbol">} </span><span class="def_Syntax">eq </span><span class="def_String">'foundation'</span><span class="def_Symbol">) </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; $<span class="def_Syntax">Variable</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">MV</span><span class="def_Symbol">_</span><span class="def_Syntax">MENU</span><span class="def_Symbol">_</span><span class="def_Syntax">DIRECTORY</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_String">'include/foundation/menus'</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Symbol">}</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Handling_the_debug_qualify_event"></a>
<h3>Handling the &quot;debug_qualify&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; debug</span><span class="def_Symbol">_</span><span class="def_Syntax">qualify&nbsp; debug</span><span class="def_Symbol">_</span><span class="def_Syntax">cgi</span><span class="def_Symbol">_</span>check<br>
<br>
<span class="def_Syntax">Sub debug</span><span class="def_Symbol">_</span><span class="def_Syntax">cgi</span><span class="def_Symbol">_</span><span class="def_Syntax">check </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return </span>$<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">debug</span><span class="def_Symbol">}</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The above will only allow debug messages to be written into the
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/DebugFile.html" title="DebugFile (config)">DebugFile</a></span> if <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">cgi</a> debug]</span>
is set to a <em>true</em> value.
</p>
<a name="Handling_the_flypage_event"></a>
<h3>Handling the &quot;flypage&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; flypage&nbsp; bounce</span><span class="def_Symbol">_</span>variants<br>
<br>
<span class="def_Syntax">Sub bounce</span><span class="def_Symbol">_</span><span class="def_Syntax">variants </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">my </span>$<span class="def_Syntax">sku </span><span class="def_Symbol">= </span><span class="def_Syntax">shift</span><span class="def_Symbol">;</span><br>
<br>
&nbsp; &nbsp; <span class="def_Syntax">my </span>$<span class="def_Syntax">override </span><span class="def_Symbol">= </span>$<span class="def_Syntax">Tag</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Syntax">data</span><span class="def_Symbol">(</span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="def_Syntax">table </span><span class="def_Symbol">=</span><span class="def_Symbol">&gt; </span><span class="def_String">'variants'</span><span class="def_Symbol">,</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="def_Syntax">column </span><span class="def_Symbol">=</span><span class="def_Symbol">&gt; </span><span class="def_String">'sku'</span><span class="def_Symbol">,</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="def_Syntax">key </span><span class="def_Symbol">=</span><span class="def_Symbol">&gt; </span>$<span class="def_Syntax">sku</span><span class="def_Symbol">,</span><br>
&nbsp; &nbsp; <span class="def_Symbol">}</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return length</span><span class="def_Symbol">(</span>$<span class="def_Syntax">override</span><span class="def_Symbol">) </span><span class="def_Symbol">? </span>$<span class="def_Syntax">override </span><span class="def_Symbol">: </span>$<span class="def_Syntax">sku</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The above code will show users the base SKU when they ask to
see a variant.&nbsp;
The code will check whether the requested SKU is listed in the
&quot;<span class="fixedwidth">variants</span>&quot; table.&nbsp;
If so then the base SKU will be returned,
otherwise the requested SKU will be returned.&nbsp;
The returned SKU will be displayed on the subsequent <em>flypage</em>.
</p>
<a name="Handling_the_guess_cc_type_event"></a>
<h3>Handling the &quot;guess_cc_type&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; guess</span><span class="def_Symbol">_</span><span class="def_Syntax">cc</span><span class="def_Symbol">_</span><span class="def_Syntax">type&nbsp; check</span><span class="def_Symbol">_</span><span class="def_Syntax">card</span><span class="def_Symbol">_</span>type<br>
<br>
<span class="def_Syntax">Sub check</span><span class="def_Symbol">_</span><span class="def_Syntax">card</span><span class="def_Symbol">_</span><span class="def_Syntax">type </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">my </span>$<span class="def_Syntax">num </span><span class="def_Symbol">= </span><span class="def_Syntax">shift</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return </span><span class="def_String">'LOCAL_TYPE' </span><span class="def_Syntax">if </span>$<span class="def_Syntax">num </span><span class="def_Symbol">=</span><span class="def_Symbol">~ </span><span class="def_Symbol">/</span><span class="def_Symbol">^</span><span class="def_Number">41</span><span class="def_Symbol">/</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return </span><span class="def_Number">0</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Handling_the_init_session_event"></a>
<h3>Handling the &quot;init_session&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; init</span><span class="def_Symbol">_</span><span class="def_Syntax">session&nbsp; on</span><span class="def_Symbol">_</span><span class="def_Syntax">init</span><span class="def_Symbol">_</span>session<br>
<br>
<span class="def_Syntax">Sub on</span><span class="def_Symbol">_</span><span class="def_Syntax">init</span><span class="def_Symbol">_</span><span class="def_Syntax">session </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">my </span>$<span class="def_Syntax">session </span><span class="def_Symbol">= </span><span class="def_Syntax">shift</span><span class="def_Symbol">;</span><br>
<br>
&nbsp; &nbsp; <span class="def_Syntax">if </span><span class="def_Symbol">(</span><span class="def_Syntax">grep </span><span class="def_Symbol">{ </span>$CGI<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">remote</span><span class="def_Symbol">_</span><span class="def_Syntax">addr </span><span class="def_Symbol">} </span>@<span class="def_Syntax">blacklisted</span><span class="def_Symbol">_</span><span class="def_Syntax">IPs</span><span class="def_Symbol">) </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; $<span class="def_Syntax">session</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">blacklist</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_Number">1</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Symbol">}</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
In the event of a client coming from a &quot;blacklisted&quot; IP address,
the blacklist entry in the user's session would be created.&nbsp;
At a later stage, &quot;blacklisted&quot; sessions could be prevented from ordering
items, as the order is markedly more likely to be fraudulent.
</p>
<a name="Handling_the_lockout_event"></a>
<h3>Handling the &quot;lockout&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; lockout&nbsp; on</span><span class="def_Symbol">_</span>lockout<br>
<br>
<span class="def_Syntax">Sub on</span><span class="def_Symbol">_</span><span class="def_Syntax">lockout </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return </span>$<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">Scratch</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">override</span><span class="def_Symbol">_</span><span class="def_Syntax">lockout</span><span class="def_Symbol">}</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The above code will return the value of the &quot;<span class="fixedwidth">override_lockout</span>&quot; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratchpad</a> variable.&nbsp;
If the value is <em>true</em> (non-zero and not blank or undefined)
then the user will not be locked out for exceeding the
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/RobotLimit.html" title="RobotLimit (config)">RobotLimit</a></span>.
</p>
<a name="Handling_the_missing_event"></a>
<h3>Handling the &quot;missing&quot; event</h3>
<p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; missing&nbsp; on</span><span class="def_Symbol">_</span>missing<br>
<br>
<span class="def_Syntax">Sub on</span><span class="def_Symbol">_</span><span class="def_Syntax">missing&nbsp; </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; <span class="def_Syntax">my </span>$<span class="def_Syntax">name </span><span class="def_Symbol">= </span><span class="def_Syntax">shift</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return unless </span>$<span class="def_Syntax">name </span><span class="def_Symbol">=</span><span class="def_Symbol">~ </span><span class="def_Symbol">/</span><span class="def_Symbol">^</span><span class="def_Symbol">[</span>A<span class="def_Symbol">-</span>Z<span class="def_Symbol">]</span><span class="def_Symbol">/</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">name </span><span class="def_Symbol">=</span><span class="def_Symbol">~ </span>s<span class="def_Number">,</span><span class="def_Symbol">_</span><span class="def_Symbol">, </span><span class="def_Symbol">,</span>g<span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">my </span><span class="def_Symbol">(</span>$<span class="def_Syntax">prod</span><span class="def_Symbol">_</span><span class="def_Syntax">group</span><span class="def_Symbol">, </span>$<span class="def_Syntax">category</span><span class="def_Symbol">) </span><span class="def_Symbol">= </span><span class="def_Syntax">split</span><span class="def_Symbol">(</span><span class="def_String">'/'</span><span class="def_Symbol">,</span>$<span class="def_Syntax">name</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
<br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">st</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_String">'db'</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">fi</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_String">'products'</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">sp</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_String">'results'</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">co</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_Number">1</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">sf</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_Syntax">join</span><span class="def_Symbol">(</span><span class="def_String">&quot;\0&quot;</span><span class="def_Symbol">,</span><span class="def_String">'prod_group'</span><span class="def_Symbol">,</span><span class="def_String">'category'</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">op</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_Syntax">join</span><span class="def_Symbol">(</span><span class="def_String">&quot;\0&quot;</span><span class="def_Symbol">,</span><span class="def_String">'eq'</span><span class="def_Symbol">,</span><span class="def_String">'eq'</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">se</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_Syntax">join</span><span class="def_Symbol">(</span><span class="def_String">&quot;\0&quot;</span><span class="def_Symbol">,</span>$<span class="def_Syntax">prod</span><span class="def_Symbol">_</span><span class="def_Syntax">group</span><span class="def_Symbol">,</span>$<span class="def_Syntax">category</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">CGI</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Symbol">{</span><span class="def_Syntax">mv</span><span class="def_Symbol">_</span><span class="def_Syntax">todo</span><span class="def_Symbol">} </span><span class="def_Symbol">= </span><span class="def_String">'search'</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; $<span class="def_Syntax">Tag</span><span class="def_Symbol">-</span><span class="def_Symbol">&gt;</span><span class="def_Syntax">update</span><span class="def_Symbol">(</span><span class="def_String">'process'</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
<br>
&nbsp; &nbsp; <span class="def_Syntax">return </span><span class="def_Symbol">(</span><span class="def_Number">1</span><span class="def_Symbol">,</span><span class="def_String">'results'</span><span class="def_Symbol">)</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Handling_the_request_init_event"></a>
<h3>Handling the &quot;request_init&quot; event</h3>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">SpecialSub&nbsp; request</span><span class="def_Symbol">_</span><span class="def_Syntax">init&nbsp; on</span><span class="def_Symbol">_</span><span class="def_Syntax">request</span><span class="def_Symbol">_</span>init<br>
<br>
<span class="def_Syntax">Sub on</span><span class="def_Symbol">_</span><span class="def_Syntax">request</span><span class="def_Symbol">_</span><span class="def_Syntax">init </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOS<br>
<span class="def_Syntax">sub </span><span class="def_Symbol">{</span><br>
&nbsp; &nbsp; $CGI<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">user </span><span class="def_Symbol">= </span>$CGI<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">server</span><span class="def_Symbol">_</span><span class="def_Syntax">host</span><span class="def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">return </span><span class="def_Number">0</span><span class="def_Symbol">;</span><br>
<span class="def_Symbol">}</span><br>
EOS
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
</div>

<!-- start of modification notice -->
<div class="wikitext">
    <table class="pageinfo" cellpadding="0" cellspacing="0">
	<tr>
	    <td>
Category:&nbsp; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/category:Local_config_directives.html">Local config directives</a>
	    </td>
	</tr>


	<tr>
	    <td>
		
		Last modified by: <a href="http://interchange-rtfm.pullingshots.ca/account/profile.html?user=pj">Peter Ajamian</a><br>
		Modification date: Sunday 24 May 2009 at 2:00 PM (BST)
	    </td>
	</tr>
    </table>
</div>
<!-- end of modification notice -->



<!-- end page: wiki/display (config/SpecialSub) -->



<!-- end of page text -->
	    </td>

	</tr>
    </table>
<!-- START VAR: FOOTER -->

<table id="rtfmfooter" width="100%" cellpadding="0" cellspacing="0">
    <tr>
	<td>
	    <a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/legal/legal.html">Legal nonsense</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/legal/privacy.html">Privacy policy</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/donations.html">Donations</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/contact.html">Contact us</a>
	</td>

    </tr>
</table>

<!-- END VAR: FOOTER -->

<!-- START VAR: COPYRIGHT -->


    <div class="copyright">
	Copyright &copy; 2001-2015
	<a href="http://cursor.biz/index.html">Cursor Software Limited</a>.&nbsp;
	All Rights Reserved.
    </div>

<!-- END VAR: COPYRIGHT -->

</body>
</html>
