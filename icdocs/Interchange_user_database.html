<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>Interchange user database - RTFM</title>

    <meta http-equiv="Content-Language" content="en-GB">
    <meta http-equiv="Window-target" content="_top">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
    <meta http-equiv="X-Soup-Of-The-Day" content="Tomato">

    <meta name="author" content="Kevin Walsh">
    <meta name="publisher" content="Cursor Software Limited">
    <meta name="copyright" content="2001-2016, Cursor Software Limited">
    <meta name="licence" content="GPLv2+ (Unknown licence)">
    <meta name="generator" content="Interchange 5.7.0 -- www.icdevgroup.org">
    <meta name="robots" content="index,follow,noarchive,noimageindex">
    <meta name="keywords" content="Interchange, Interchange Help, Interchange Support, Interchange Documentation, Interchange Downloads, Interchange Resources">
    <meta name="description" content="Interchange, Interchange Help, Interchange Support, Interchange Documentation, Interchange Downloads, Interchange Resources">
    <meta name="MSSmartTagsPreventParsing" content="TRUE">

    <meta name="verify-v1" content="KqlU/bxZj9Y2ZdZ/3RwuzgVSMIrZ8XM2wqbjSaEo3O4=">

    <meta name="y_key" content="e2dd60be5777fbc8">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" type="image/png">
    <link rel="search" type="application/opensearchdescription+xml" href="http://interchange-rtfm.pullingshots.ca/cms/mozilla_search_plugin.xml" title="Interchange RTFM website">
    <link rel="stylesheet" href="/decor/css/website.css">
    <link rel="stylesheet" href="/decor/css/wiki.css">
    <link rel="stylesheet" href="/decor/css/neo.css">


    <script type="text/javascript" language="JavaScript">
    <!--
	if (top != self){
	    top.location = location;
	}

    // -->
    </script>
</head>
<body>
<!-- START VAR: LOGOBAR -->
<table id="rtfmheader" cellpadding="0" cellspacing="0">
    <tr>
	<td><a href="http://interchange-rtfm.pullingshots.ca/index.html" title="For more information... RTFM!"><img src="/decor/images/rtfm_banner.gif" width="500" height="60" border="0" alt="For more information... RTFM!"></a></td>

	<td width="100%" style="text-align: right; padding: 10px">

	    <form action="http://interchange-rtfm.pullingshots.ca/search.html" method="POST">
		<input type="hidden" name="mv_session_id" value="nsession">
		<input type="hidden" name="mv_profile" value="cms_search">
		<input name="mv_searchspec" value="" type="text" size="15" maxlength="100" class="search">
		<input type="submit" class="button" value="Search">
	    </form>

	</td>
    </tr>
</table>
<table id="breadcrumbs" cellpadding="0" cellspacing="0">
    <tr valign="top">
	<td>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/documentation.html">Documentation</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/index.html">Latest documentation</a></span>
	    <span class="nowrap">&gt; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/category:Interchange_database.html">Interchange database</a></span>
	    <span class="nowrap">&gt; <span class="current">Interchange user database</span></span>
	</td>

    </tr>
</table>
<!-- END VAR: LOGOBAR -->

    <table width="100%" cellpadding="0" cellspacing="0" border="0">
	<tr valign="top">

	    <td id="leftside">
<!-- START COMPONENT: navigation -->

<table class="component" cellpadding="0" cellspacing="0">
    <tr>
	<th>NAVIGATION</th>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/documentation.html">Documentation</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/downloads.html">Downloads</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/community.html">Mail lists and IRC</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/links.html">External websites</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/contributions.html">Suggestions and contributions</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/usermap.html">User location map</a></li>
	    </ul>
	</td>
    </tr>
</table>



<!-- END COMPONENT: navigation -->
<!-- START COMPONENT: wiki_recent -->



<!-- END COMPONENT: wiki_recent -->
<!-- START COMPONENT: wiki_backlinks -->

<table class="component" cellpadding="0" cellspacing="0">
    <tr>
	<th><span class="nowrap">PAGES THAT LINK HERE</span></th>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/delete-cart.html">delete-cart</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/load-cart.html">load-cart</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/Page_access_control.html">Page access control</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/save-cart.html">save-cart</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html">userdb</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html">UserDB</a></li>
	    </ul>
	</td>
    </tr>
</table>


<!-- END COMPONENT: wiki_backlinks -->
<!-- START COMPONENT: account -->

<table class="component" cellpadding="0" cellspacing="0">

    <tr>
	<th>ACCOUNT LOGIN</th>
    </tr>

    <tr>
	<td class="first">
	    <p>You are not logged in</p>
	</td>
    </tr>
    <tr>
	<td>
	    <ul class="navigation">
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/login.html">Log in</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/create.html">Create an account</a></li>
		<li><a href="http://interchange-rtfm.pullingshots.ca/account/reminder.html">Password reminder</a></li>
	    </ul>
	</td>
    </tr>

</table>



<!-- END COMPONENT: account -->
<!-- START COMPONENT: icpowered -->

<div style="text-align: center; margin: 10px; margin-top: 0px">
    <a href="http://interchange-rtfm.pullingshots.ca/bouncer.html?target=http%3a%2f%2fwww%2eicdevgroup%2eorg%2f" title="Powered by Interchange version 5.7.0"><img src="/decor/images/iclogo_button.gif" width="136" height="44" alt="Powered by Interchange version 5.7.0"></a>
</div>



<!-- START COMPONENT: icpowered -->

	    </td>

	    <td id="bodytext">
<!-- start of page text -->

<!-- start page: wiki/display (Interchange_user_database) -->

<div class="wikitext">
<a name="Interchange_user_database"></a>
<h1>Interchange user database</h1>
<!-- start of toc --><div class="toc">
<table>
<tr valign="top">
<th>Table of contents</th>
</tr>
<tr><td class="h2"><a href="#Introduction">1. Introduction</a></td></tr>
<tr><td class="h2"><a href="#Access_to_the_user_database_tables">2. Access to the user database table(s)</a></td></tr>
<tr><td class="h2"><a href="#User_database_functions">3. User database functions</a></td></tr>
<tr><td class="h3"><a href="#General">3.1. General</a></td></tr>
<tr><td class="h4"><a href="#change_pass">3.1.1. change_pass</a></td></tr>
<tr><td class="h4"><a href="#login">3.1.2. login</a></td></tr>
<tr><td class="h4"><a href="#logout">3.1.3. logout</a></td></tr>
<tr><td class="h4"><a href="#new_account">3.1.4. new_account</a></td></tr>
<tr><td class="h4"><a href="#save">3.1.5. save</a></td></tr>
<tr><td class="h3"><a href="#Shipping">3.2. Shipping</a></td></tr>
<tr><td class="h4"><a href="#delete_shipping">3.2.1. delete_shipping</a></td></tr>
<tr><td class="h4"><a href="#get_shipping">3.2.2. get_shipping</a></td></tr>
<tr><td class="h4"><a href="#get_shipping_names">3.2.3. get_shipping_names</a></td></tr>
<tr><td class="h4"><a href="#set_shipping">3.2.4. set_shipping</a></td></tr>
<tr><td class="h3"><a href="#Billing">3.3. Billing</a></td></tr>
<tr><td class="h4"><a href="#delete_billing">3.3.1. delete_billing</a></td></tr>
<tr><td class="h4"><a href="#get_billing">3.3.2. get_billing</a></td></tr>
<tr><td class="h4"><a href="#get_billing_names">3.3.3. get_billing_names</a></td></tr>
<tr><td class="h4"><a href="#set_billing">3.3.4. set_billing</a></td></tr>
<tr><td class="h3"><a href="#Shopping_carts">3.4. Shopping carts</a></td></tr>
<tr><td class="h4"><a href="#delete_cart">3.4.1. delete_cart</a></td></tr>
<tr><td class="h4"><a href="#get_cart">3.4.2. get_cart</a></td></tr>
<tr><td class="h4"><a href="#get_cart_names">3.4.3. get_cart_names</a></td></tr>
<tr><td class="h4"><a href="#set_cart">3.4.4. set_cart</a></td></tr>
<tr><td class="h3"><a href="#Access_control_lists">3.5. Access control lists</a></td></tr>
<tr><td class="h4"><a href="#check_acl">3.5.1. check_acl</a></td></tr>
<tr><td class="h4"><a href="#check_file_acl_and_check_db_acl">3.5.2. check_file_acl and check_db_acl</a></td></tr>
<tr><td class="h4"><a href="#set_acl">3.5.3. set_acl</a></td></tr>
<tr><td class="h4"><a href="#set_file_acl_and_set_db_acl">3.5.4. set_file_acl and set_db_acl</a></td></tr>
<tr><td class="h2"><a href="#Address_book">4. Address book</a></td></tr>
<tr><td class="h2"><a href="#Accounts_book">5. Accounts book</a></td></tr>
<tr><td class="h2"><a href="#Preferences">6. Preferences</a></td></tr>
<tr><td class="h2"><a href="#Carts">7. Carts</a></td></tr>
<tr><td class="h2"><a href="#Controlling_page_access_with_UserDB">8. Controlling page access with UserDB</a></td></tr>
<tr><td class="h2"><a href="#Using_more_than_one_database_table">9. Using more than one database table</a></td></tr>
<tr>
<td class="spacer">&nbsp;</td>
</tr>
</table>
</div><!-- end of toc -->
<a name="Introduction"></a>
<h2>Introduction</h2>
<p>
Interchange has a &quot;user database&quot; facility that allows users to save
certain values from their session.&nbsp;
It also allows the setting of database table or file access control lists
for use in controlling access to those facilities on a user-by-user basis.
</p>
<p>
The column names in the <em>userdb</em> table correspond with
<span class="fixedwidth">&lt;form&gt;</span> variable names in the user's session;&nbsp;
If there is a column named &quot;<span class="fixedwidth">address</span>&quot;, when the user logs in,
then the contents of that column will read, and will be available for
display using <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">value</a>&nbsp;address]</span>.&nbsp;
Similarly, the column's value would be available with the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">data table</span><span class="def_Symbol">=</span><span class="def_String">&quot;userdb&quot; </span><span class="def_Syntax">column</span><span class="def_Symbol">=</span><span class="def_String">&quot;address&quot; </span><span class="def_Syntax">key</span><span class="def_Symbol">=</span><span class="def_String">&quot;username&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The <em>userdb</em> table's column names to be used are not set in stone;&nbsp;
They may be changed with options,
and columns may be added or subtracted at any time.&nbsp;
Most users will choose to keep the default <em>Standard</em> demo column
names for simplicity, as they cover most common needs.&nbsp;
The <em>Standard</em> e-commerce demo makes use of the following columns:
</p>
<!-- start of list --><table class="categorytoc" width="100%" cellpadding="0" cellspacing="0" border="0">
<tr valign="top">
<td width="33%">
<ul>
<li>code</li>
<li>accounts</li>
<li>acl</li>
<li>address</li>
<li>address_book</li>
<li>b_address</li>
<li>b_city</li>
<li>b_country</li>
<li>b_name</li>
<li>b_nickname</li>
<li>b_phone</li>
<li>b_state</li>
<li>b_zip</li>
</ul>
</td>
<td width="33%">
<ul>
<li>carts</li>
<li>city</li>
<li>country</li>
<li>db_acl</li>
<li>email</li>
<li>email_copy</li>
<li>fax</li>
<li>fax_order</li>
<li>file_acl</li>
<li>mv_credit_card_exp_month</li>
<li>mv_credit_card_exp_year</li>
<li>mv_credit_card_info</li>
<li>mv_credit_card_type</li>
</ul>
</td>
<td width="33%">
<ul>
<li>mv_shipmode</li>
<li>name</li>
<li>order_numbers</li>
<li>p_nickname</li>
<li>password</li>
<li>phone_day</li>
<li>phone_night</li>
<li>preferences</li>
<li>s_nickname</li>
<li>state</li>
<li>time</li>
<li>zip</li>
</ul>
</td>
</tr>
</table><!-- end of list -->

<p>
A few of those columns have <em>special</em> names.&nbsp;
although all can be changed via an option.&nbsp;
A couple of the columns are reserved for Interchange's use.
</p>

<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_note.gif" width="32" height="32" border="0" alt="Note">
</td>
<td width="100%">
<p class="title">Note</p>
<p style="margin-bottom: 0px">
If you are not running with GnuPG, PGP or another form of encryption
for credit card details (which is never recommended),
it is important that the &quot;<span class="fixedwidth">mv_credit_card_info</span>&quot; column is
removed from the table so that the value can be ignored.&nbsp;
Failure to remove this column will result in encryption-related errors.
</p>
</td>
</tr>
</table>

<p>
The <em>special</em> columns are as follows:
</p>
<table class="border">
<tr valign="top">
<th class="grid">Name
</th>
<th class="grid">Description
</th>
</tr>
<tr valign="top">
<td class="grid">carts
</td>
<td class="grid">Storage area for saved <a href="#Carts" title="&quot;Carts&quot; heading on this page">shopping carts</a>.</td>
</tr>
<tr valign="top">
<td class="grid">address_book
</td>
<td class="grid">Storage area for <a href="#Address_book" title="&quot;Address book&quot; heading on this page">shipping address book</a>.</td>
</tr>
<tr valign="top">
<td class="grid">accounts
</td>
<td class="grid">Storage area for <a href="#Accounts_book" title="&quot;Accounts book&quot; heading on this page">billing accounts book</a>.</td>
</tr>
<tr valign="top">
<td class="grid">preferences
</td>
<td class="grid">Storage area for <a href="#Preferences" title="&quot;Preferences&quot; heading on this page">user preferences</a>.</td>
</tr>
<tr valign="top">
<td class="grid">nickname
</td>
<td class="grid">Nickname for a saved cart record.</td>
</tr>
<tr valign="top">
<td class="grid">s_nickname
</td>
<td class="grid">Nickname for a saved shipping address record.</td>
</tr>
<tr valign="top">
<td class="grid">b_nickname
</td>
<td class="grid">Nickname for a saved billing account record.</td>
</tr>
<tr valign="top">
<td class="grid">p_nickname
</td>
<td class="grid">Nickname for a saved preferences record.</td>
</tr>
<tr valign="top">
<td class="grid">acl
</td>
<td class="grid">Storage for simple integrated access control.</td>
</tr>
<tr valign="top">
<td class="grid">db_acl
</td>
<td class="grid">Storage for database access control lists.</td>
</tr>
<tr valign="top">
<td class="grid">file_acl
</td>
<td class="grid">Storage for file access control lists.</td>
</tr>
</table>

<p>
If a column not present, the corresponding capability will not be available.
</p>

<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_note.gif" width="32" height="32" border="0" alt="Note">
</td>
<td width="100%">
<p class="title">Note</p>
<p style="margin-bottom: 0px">
The &quot;<span class="fixedwidth">accounts</span>&quot;, &quot;<span class="fixedwidth">address_book</span>&quot;, &quot;<span class="fixedwidth">carts</span>&quot; and
&quot;<span class="fixedwidth">preferences</span>&quot; columns should be defined using the <span class="fixedwidth">BLOB</span>
datatype, if using SQL.&nbsp;
This is also recommended for the various <em>acl</em> columns,
as those lists could grow to be quite large.
</p>
</td>
</tr>
</table>

<p>
Reserved fields include:
</p>
<table class="border">
<tr valign="top">
<th class="grid">Name
</th>
<th class="grid">Description
</th>
</tr>
<tr valign="top">
<td class="grid">code
</td>
<td class="grid">The username (also the key for the table).</td>
</tr>
<tr valign="top">
<td class="grid">password
</td>
<td class="grid">Password storage.</td>
</tr>
<tr valign="top">
<td class="grid">time
</td>
<td class="grid">Last login date/time.</td>
</tr>
</table>

<a name="Access_to_the_user_database_tables"></a>
<h2>Access to the user database table(s)</h2>
<p>
Interchange provides a <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> tag,
which allows access to the Interchange user database table(s).
</p>
<p>
Interchange also provides a <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html" title="UserDB (config)">UserDB</a></span> <em>local</em>
configuration directive, which allows various defaults to be set
so that they don't have to be supplied to the <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> tag
on every call.&nbsp;
The <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html" title="UserDB (config)">UserDB</a></span> directive also allows you to rename
remap most of the <em>userdb</em> columns, rename the <em>userdb</em> table
itself and even use other tables to store and look up <em>userdb</em> data.
</p>
<a name="User_database_functions"></a>
<h2>User database functions</h2>
<p>
The user database features are implemented as a series of functions
available via the <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> tag.&nbsp;
The functions are as follows:
</p>
<a name="General"></a>
<h3>General</h3>
<a name="change_pass"></a>
<h4>change_pass</h4>
<p>
Change the password on the currently logged-in account.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">username</span>, <span class="fixedwidth">password</span>, <span class="fixedwidth">verify</span>
<span class="fixedwidth">oldpass</span> and <span class="fixedwidth">cgi</span>.
</p>
<p>
This function requires the &quot;<span class="fixedwidth">username</span>&quot;, &quot;<span class="fixedwidth">password</span>&quot;,
&quot;<span class="fixedwidth">verify</span>&quot; and &quot;<span class="fixedwidth">oldpass</span>&quot; parameters,
which are, by default, expected to be contained in the <a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a>
space, in the &quot;<span class="fixedwidth">mv_username</span>&quot;, &quot;<span class="fixedwidth">mv_password</span>&quot;,
&quot;<span class="fixedwidth">mv_verify</span>&quot; and &quot;<span class="fixedwidth">mv_password_old</span>&quot; respectively.&nbsp;
If the &quot;<span class="fixedwidth">cgi</span>&quot; parameter is set <em>true</em> then
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">&#36;CGI</a></span> will be used instead of
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span>.
</p>
<a name="login"></a>
<h4>login</h4>
<p>
Log in to an Interchange user account.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">username</span>, <span class="fixedwidth">password</span>, <span class="fixedwidth">crypt</span>, <span class="fixedwidth">md5</span>,
<span class="fixedwidth">pass_field</span>, <span class="fixedwidth">ignore_case</span>, <span class="fixedwidth">indirect_login</span>
and <span class="fixedwidth">cgi</span>.
</p>
<p>
By default, the &quot;<span class="fixedwidth">username</span>&quot; is expected to be contained in
&quot;<span class="fixedwidth">mv_username</span>&quot; and the &quot;<span class="fixedwidth">password</span>&quot; in &quot;<span class="fixedwidth">mv_password</span>&quot;,
both in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span> space.&nbsp;
If the &quot;<span class="fixedwidth">cgi</span>&quot; parameter is set <em>true</em> then
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">&#36;CGI</a></span> will be used instead of
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span>.
</p>
<p>
If &quot;<span class="fixedwidth">indirect_login</span>&quot; is used, it should be set to a column name that
can be used as a lookup for the <em>real</em> username.&nbsp;
The &quot;<span class="fixedwidth">email</span>&quot; column is a common &quot;<span class="fixedwidth">indirect_login</span>&quot; setting.&nbsp;
This also calls the &quot;<span class="fixedwidth"><a href="#new_account" title="&quot;new account&quot; heading on this page">new_account</a></span>&quot; function to create a user account based, upon an assigned username,
and so the &quot;<span class="fixedwidth">assign_username</span>&quot; parameter should always be set
<em>true</em> when using the &quot;<span class="fixedwidth">indirect_login</span>&quot; facility.
</p>
<p>
If the login is successful, the &quot;<span class="fixedwidth">username</span>&quot; <em>session</em> value
(<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/data.html" title="data (tags)">data</a> session username]</span>) will be set to the value
of the &quot;<span class="fixedwidth">userdb.username</span>&quot; column.&nbsp;
Well, that is unless
&quot;<span class="fixedwidth">indirect_login</span>&quot; is used, in which case
<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/data.html" title="data (tags)">data</a> session username]</span> will be set to the value of the
named <em>indirect</em> column.
</p>
<p>
The login will recall the values of all non-special columns in the user's
<em>userdb</em> row and place them in correspondingly-named variables,
for lookup using the <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">value</a>]</span>
(or possibly <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratch</a>]</span>) tag.
</p>
<p>
The <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/CookieLogin.html" title="CookieLogin (config)">CookieLogin</a></span> <em>local</em> configuration directive
allows users to save their username and password in a browser <em>cookie</em>.&nbsp;
The <em>cookie</em> expiration time is set by <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/SaveExpire.html" title="SaveExpire (config)">SaveExpire</a></span>,
and renewed every time they log in.&nbsp;
To cause the cookie to be generated originally,
the &quot;<span class="fixedwidth">mv_cookie_password</span>&quot; or &quot;<span class="fixedwidth">mv_cookie_username</span>&quot; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">values</a> must be set <em>true</em> (usually set via the login form).&nbsp;
The former causes both &quot;<span class="fixedwidth">username</span>&quot; and &quot;<span class="fixedwidth">password</span>&quot; values to be
saved, the latter just the &quot;<span class="fixedwidth">username</span>&quot;.
</p>
<a name="logout"></a>
<h4>logout</h4>
<p>
Log out of the current Interchange user account.
</p>
<p>
No additional parameters are required,
although can specify the &quot;<span class="fixedwidth">clear=1</span>&quot; parameter,
which will clear the user's session of all of the form
<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">values</a> and <a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratchpad</a> variables
that were loaded/saved by the <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> tag.
</p>
<p>
You can also specify the &quot;<span class="fixedwidth">clear_session=1</span>&quot; parameter,
which will force an entirely new session to be created for the
user.
</p>
<a name="new_account"></a>
<h4>new_account</h4>
<p>
Create a new Interchange user account.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">username</span>, <span class="fixedwidth">password</span>, <span class="fixedwidth">verify</span>,
<span class="fixedwidth">assign_username</span>, <span class="fixedwidth">username_mask</span>, <span class="fixedwidth">ignore_case</span>
<span class="fixedwidth">indirect_login</span> and <span class="fixedwidth">cgi</span>.
</p>
<p>
This function requires the &quot;<span class="fixedwidth">username</span>&quot;, &quot;<span class="fixedwidth">password</span>&quot; and &quot;<span class="fixedwidth">verify</span>&quot; parameters which are, by default, expected to be
contained in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span> space,
in the &quot;<span class="fixedwidth">mv_username</span>&quot;,
&quot;<span class="fixedwidth">mv_password</span>&quot;, &quot;<span class="fixedwidth">mv_verify</span>&quot; respectively
If the &quot;<span class="fixedwidth">cgi</span>&quot; parameter is set <em>true</em> then
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">&#36;CGI</a></span> will be used instead of
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span>.
</p>
<p>
If the &quot;<span class="fixedwidth">assign_username</span>&quot; parameter is <em>true</em> then a sequential
username will be assigned.&nbsp;
The &quot;<span class="fixedwidth">counter</span>&quot; parameter can be used to set the filename
(which must be relative to the website's home directory, as configured using
the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/Catalog.html" title="Catalog (config)">Catalog</a></span> <em>global</em> directive),
or the default of &quot;<span class="fixedwidth">etc/username.counter</span> will be used.&nbsp;
Using the default counting mechanism, the first username will be
&quot;<span class="fixedwidth">U0001</span>&quot; if the counter file doesn't already exist.
</p>
<p>
If <span class="fixedwidth">assign_username</span> is used, you can choose to have a
<em>pseudo-username</em> that is different from the <em>real</em> username.&nbsp;
(The user's email address is commonly used for this.)
The <em>pseudo-username</em> column name can specified using the
&quot;<span class="fixedwidth">indirect_login</span>&quot; parameter.
</p>

<table class="note">
<tr>
<td class="icon">
<img src="/decor/images/wiki/note_warning.gif" width="32" height="32" border="0" alt="Warning">
</td>
<td width="100%">
<p class="title">Warning</p>
<p style="margin-bottom: 0px">
When the user logs in, this column will be used to find the <em>real</em>
username, so you must ensure that a UNIQUE index is present on the column.&nbsp;
If you do not have a UNIQUE index on the column, or another way to ensure
that duplicates are disallowed, then you risk getting &quot;user already exists&quot; errors.
</p>
</td>
</tr>
</table>

<p>
The &quot;<span class="fixedwidth">no_login</span>&quot; parameter prevents the user from being automatically
logged into the new account.&nbsp;
This may be useful in some applications.
</p>
<p>
The &quot;<span class="fixedwidth">ignore_case</span>&quot; parameter forces the username and password to
lower-case in the table,
rendering the username and password case-insensitive.&nbsp;
This is recommended if using email addresses as usernames.&nbsp;
In fact, it's recommended anyway.
</p>
<p>
If the &quot;<span class="fixedwidth">username_mask</span>&quot; parameter is set to a valid Perl <em>regular
expression</em> (without the surrounding &quot;<span class="fixedwidth">/&nbsp;/</span>&quot;),
then any username containing a matching string will be barred from use.&nbsp;
For example, to screen out order numbers from being used by a random user,
you could use the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">new</span><span class="def_Symbol">_</span><span class="def_Syntax">account username</span><span class="def_Symbol">_</span><span class="def_Syntax">mask</span><span class="def_Symbol">=</span><span class="def_String">&quot;^[A-Z]*[0-9]&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/CookieLogin.html" title="CookieLogin (config)">CookieLogin</a></span> <em>local</em> configuration directive
allows users to save their username and password in a browser <em>cookie</em>.&nbsp;
The <em>cookie</em> expiration time is set by <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/SaveExpire.html" title="SaveExpire (config)">SaveExpire</a></span>,
and renewed every time they log in.&nbsp;
To cause the cookie to be generated originally,
the &quot;<span class="fixedwidth">mv_cookie_password</span>&quot; or &quot;<span class="fixedwidth">mv_cookie_username</span>&quot; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">values</a> must be set <em>true</em> (usually set via the login
or &quot;create new account&quot; form).&nbsp;
The former causes both &quot;<span class="fixedwidth">username</span>&quot; and &quot;<span class="fixedwidth">password</span>&quot; values to be
saved, the latter just the &quot;<span class="fixedwidth">username</span>&quot;.
</p>
<p>
To automatically create an account for every order,
you could set the following in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/OrderReport.html" title="OrderReport (config)">OrderReport</a></span> file:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">new</span><span class="def_Symbol">_</span>account<br>
&nbsp; &nbsp; <span class="def_Syntax">username</span><span class="def_Symbol">=</span><span class="def_String">&quot;[value mv_order_number]&quot;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">password</span><span class="def_Symbol">=</span><span class="def_String">&quot;[value zip]&quot;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">verify</span><span class="def_Symbol">=</span><span class="def_String">&quot;[value zip]&quot;</span><br>
&nbsp; &nbsp; <span class="def_Syntax">table</span><span class="def_Symbol">=</span><span class="def_String">&quot;orders&quot;</span><br>
<span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
This would be coupled with a login form that asks for the order number
and <em>zip code</em>, thereby allowing the display of the content of a
transaction, with (presumably updated) order status information or a
shipping company tracking number.
</p>
<a name="save"></a>
<h4>save</h4>
<p>
Saves all <em>non-special</em> form values that have columns in the
<em>userdb</em> table(s).
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span> and <span class="fixedwidth">cgi</span>.
</p>
<p>
If a value is defined as &quot;<span class="fixedwidth">scratch</span>&quot; then it will be retrieved from
the &#91;tags/scratch|scratchpad]], otherwise it will be
retrieved from the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">&#36;Values</a></span> or
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">&#36;CGI</a></span> space, depending upon the &quot;<span class="fixedwidth">cgi</span>&quot; parameter.&nbsp;
If the column is defined as <span class="fixedwidth">outboard</span> the it will be saved in the
<span class="fixedwidth">outboard</span> table using the &quot;<span class="fixedwidth">outboard_key_col</span> value as the key.
</p>
<a name="Shipping"></a>
<h3>Shipping</h3>
<p>
See the <a href="#Address_book" title="&quot;Address book&quot; heading on this page">Address book</a> section, below.
</p>
<a name="delete_shipping"></a>
<h4>delete_shipping</h4>
<p>
Delete an entry from the <em>shipping Address book</em>.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span> and <span class="fixedwidth">addr_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">delete</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">Dad</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="get_shipping"></a>
<h4>get_shipping</h4>
<p>
Recall an entry from the <em>shipping Address book</em>.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">shipping</span> and <span class="fixedwidth">addr_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">Dad</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="get_shipping_names"></a>
<h4>get_shipping_names</h4>
<p>
Gets the names of <em>shipping address book</em> entries and places them
in the &quot;<span class="fixedwidth">address_book</span>&quot; variable.
</p>
<p>
Active <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a></span> parameters:&nbsp;
<span class="fixedwidth">addr_field</span> and <span class="fixedwidth">show</span>.
</p>
<p>
By default this does not return the values.&nbsp;
To have the values returned, set the &quot;<span class="fixedwidth">show</span>&quot; to &quot;<span class="fixedwidth">1</span>&quot;.&nbsp;
For example:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">tmp shipping</span><span class="def_Symbol">_</span><span class="def_Syntax">nicknames</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping</span><span class="def_Symbol">_</span><span class="def_Syntax">names show</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">tmp</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="set_shipping"></a>
<h4>set_shipping</h4>
<p>
Place an entry in the <em>shipping address book</em>.
</p>
<p>
Active <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a></span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">shipping</span> and <span class="fixedwidth">addr_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">Dad</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Billing"></a>
<h3>Billing</h3>
<p>
See the <a href="#Accounts_book" title="&quot;Accounts book&quot; heading on this page">Accounts book</a> section, below.
</p>
<a name="delete_billing"></a>
<h4>delete_billing</h4>
<p>
Delete an entry from the <em>billing Address book</em>.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span> and <span class="fixedwidth">bill_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">delete</span><span class="def_Symbol">_</span><span class="def_Syntax">billing nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">office</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="get_billing"></a>
<h4>get_billing</h4>
<p>
Recall an entry from the <em>billing Address book</em>.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">billing</span> and <span class="fixedwidth">bill_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">billing nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">office</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="get_billing_names"></a>
<h4>get_billing_names</h4>
<p>
Gets the names of <em>billing address book</em> entries and places them
in the &quot;<span class="fixedwidth">accounts</span>&quot; variable.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">bill_field</span> and <span class="fixedwidth">show</span>.
</p>
<p>
By default this does not return the values.&nbsp;
To have the values returned, set the &quot;<span class="fixedwidth">show</span>&quot; to &quot;<span class="fixedwidth">1</span>&quot;.&nbsp;
For example:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">tmp billing</span><span class="def_Symbol">_</span><span class="def_Syntax">nicknames</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">billing</span><span class="def_Symbol">_</span><span class="def_Syntax">names show</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">tmp</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="set_billing"></a>
<h4>set_billing</h4>
<p>
Place an entry in the <em>billing address book</em>.
</p>
<p>
Active <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a></span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">billing</span> and <span class="fixedwidth">bill_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">billing nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">office</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="Shopping_carts"></a>
<h3>Shopping carts</h3>
<p>
See the <a href="#Carts" title="&quot;Carts&quot; heading on this page">Carts</a> section, below.
</p>
<a name="delete_cart"></a>
<h4>delete_cart</h4>
<p>
Delete a saved shopping cart.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span> and <span class="fixedwidth">cart_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">delete</span><span class="def_Symbol">_</span><span class="def_Syntax">cart nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">wedding</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="get_cart"></a>
<h4>get_cart</h4>
<p>
Recall a saved shopping cart.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">cart_field</span> and <span class="fixedwidth">target</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">cart nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">wedding</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The &quot;<span class="fixedwidth">target</span>&quot; parameter causes the saved items to be loaded to
a shopping cart different from the one currently in use.&nbsp;
The &quot;<span class="fixedwidth">cart_field</span>&quot; parameter names the database column used for
cart storage.
</p>
<a name="get_cart_names"></a>
<h4>get_cart_names</h4>
<p>
Gets the names of saved shopping cart entries and places them
in the &quot;<span class="fixedwidth">address_book</span>&quot; variable.
</p>
<p>
Active <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a></span> parameters:&nbsp;
<span class="fixedwidth">cart_field</span> and <span class="fixedwidth">show</span>.
</p>
<p>
By default this does not return the values.&nbsp;
To have the values returned, set the &quot;<span class="fixedwidth">show</span>&quot; to &quot;<span class="fixedwidth">1</span>&quot;.&nbsp;
For example:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">tmp shipping</span><span class="def_Symbol">_</span><span class="def_Syntax">nicknames</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">cart</span><span class="def_Symbol">_</span><span class="def_Syntax">names show</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]</span><span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">tmp</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="set_cart"></a>
<h4>set_cart</h4>
<p>
Save the contents of a shopping cart.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">nickname</span>, <span class="fixedwidth">cart_field</span> and <span class="fixedwidth">target</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">cart nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">christmas</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The &quot;<span class="fixedwidth">target</span>&quot; parameter causes the saved items to be loaded to
a shopping cart different from the one currently in use.&nbsp;
The &quot;<span class="fixedwidth">cart_field</span>&quot; parameter names the database column used for
cart storage.
</p>
<a name="Access_control_lists"></a>
<h3>Access control lists</h3>
<a name="check_acl"></a>
<h4>check_acl</h4>
<p>
Checks the simple access control listing for a location, returning
&quot;<span class="fixedwidth">1</span>&quot; if allowed, or returning nothing at all if not allowed.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">location</span> and <span class="fixedwidth">acl_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">if type</span><span class="def_Symbol">=</span><span class="def_Syntax">explicit compare</span><span class="def_Symbol">=</span><span class="def_String">&quot;[userdb function=check_acl location=websitecfg/editcart]&quot;</span><span class="def_Symbol">]</span><br>
<span class="def_Symbol">&lt;</span><span class="def_Syntax">a href</span><span class="def_Symbol">=</span><span class="def_String">&quot;[area websitecfg/editcart]&quot;</span><span class="def_Symbol">&gt;</span><span class="def_Syntax">Edit your cart </span>configuration<span class="def_Symbol">&lt;</span><span class="def_Symbol">/</span>a<span class="def_Symbol">&gt;</span><br>
<span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">if</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="check_file_acl_and_check_db_acl"></a>
<h4>check_file_acl and check_db_acl</h4>
<p>
Checks a complex access control value and returns a <em>true</em> or <em>false</em>
value.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">location</span>, <span class="fixedwidth">mode</span>, <span class="fixedwidth">db_acl_field</span> and
<span class="fixedwidth">file_acl_field</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">check</span><span class="def_Symbol">_</span><span class="def_Syntax">db</span><span class="def_Symbol">_</span><span class="def_Syntax">acl mode</span><span class="def_Symbol">=</span><span class="def_Syntax">w location</span><span class="def_Symbol">=</span><span class="def_Syntax">inventory</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
In the above example, &quot;<span class="fixedwidth">mode</span>&quot; is any value to be checked with
&quot;<span class="fixedwidth">check_file_acl</span>&quot;.
</p>
<p>
This function will return <em>true</em> if the specified &quot;<span class="fixedwidth">mode</span>&quot; string is contained within the entry for the specified &quot;<span class="fixedwidth">location</span>&quot;.&nbsp;
The return code could be checked as follows:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">if type</span><span class="def_Symbol">=</span><span class="def_Syntax">explicit compare</span><span class="def_Symbol">=</span><span class="def_String">&quot;[userdb function=check_db_acl mode=w location=inventory]&quot;</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span>websitecfg<span class="def_Symbol">/</span><span class="def_Syntax">update</span><span class="def_Symbol">_</span><span class="def_Syntax">inventory</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Syntax">Click here to update the </span>inventory<span class="def_Symbol">:</span><br>
&nbsp; &nbsp; <span class="def_Symbol">&lt;</span><span class="def_Syntax">a href</span><span class="def_Symbol">=</span><span class="def_String">&quot;[area websitecfg/update_inventory]&quot;</span><span class="def_Symbol">&gt;</span><span class="def_Syntax">You may update the </span>inventory<span class="def_Symbol">&lt;</span><span class="def_Symbol">/</span>a<span class="def_Symbol">&gt;</span><br>
<span class="def_Symbol">[</span><span class="def_Syntax">else</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span>websitecfg<span class="def_Symbol">/</span><span class="def_Syntax">edit</span><span class="def_Symbol">_</span><span class="def_Syntax">inventory delete</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Syntax">Sorry</span><span class="def_Symbol">, </span><span class="def_Syntax">you are not allowed to update the inventory</span><span class="def_Symbol">.</span><br>
<span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">if</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
See the <a href="#Controlling_page_access_with_UserDB" title="&quot;Controlling page access with UserDB&quot; heading on this page">Controlling page access with UserDB</a> section, below.
</p>
<a name="set_acl"></a>
<h4>set_acl</h4>
<p>
Set a simple acl.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">location</span>, <span class="fixedwidth">acl_field</span> and <span class="fixedwidth">delete</span>.
</p>
<p>
The following would allow the current user access to the
&quot;<span class="fixedwidth">somedir/somepage</span>&quot;,
if it is protected using the
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/Page_access_control.html#MV_USERDB_ACL_TABLE_variable" title="&quot;MV USERDB ACL TABLE variable&quot; heading on the &quot;Page access control&quot; page">MV_USERDB_ACL_TABLE</a></span>
mechanism:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span>somedir<span class="def_Symbol">/</span><span class="def_Syntax">somepage</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The following would delete access:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span>somedir<span class="def_Symbol">/</span><span class="def_Syntax">somepage delete</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
You can use the &quot;<span class="fixedwidth">show</span>&quot; parameter to display the setting
at the same time:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span>somedir<span class="def_Symbol">/</span><span class="def_Syntax">somepage show</span><span class="def_Symbol">=</span><span class="def_Number">1</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<a name="set_file_acl_and_set_db_acl"></a>
<h4>set_file_acl and set_db_acl</h4>
<p>
Sets a complex access control values.
</p>
<p>
Active <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> parameters:&nbsp;
<span class="fixedwidth">location</span>, <span class="fixedwidth">mode</span>, <span class="fixedwidth">db_acl_field</span>,
<span class="fixedwidth">file_acl_field</span> and <span class="fixedwidth">delete</span>.
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">file</span><span class="def_Symbol">_</span><span class="def_Syntax">acl mode</span><span class="def_Symbol">=</span><span class="def_Syntax">rw location</span><span class="def_Symbol">=</span>products<span class="def_Symbol">/</span><span class="def_Syntax">inventory</span><span class="def_Number">.</span><span class="def_Syntax">txt</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
In the above example, &quot;<span class="fixedwidth">mode</span>&quot; is any value to be checked with
&quot;<span class="fixedwidth">check_file_acl</span>&quot;.&nbsp;
As with the simple ACL, use <span class="fixedwidth">delete=1</span> to delete the entry altogether.
</p>
<a name="Address_book"></a>
<h2>Address book</h2>
<p>
This refers to the <em>shipping</em> address book, as opposed to the
<em>billing</em> address book.&nbsp;
The shipping address book saves information relevant to order shipments.&nbsp;
In its simplest form, this can be the only address book needed.&nbsp;
By default the following <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">value</a></span>, <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">cgi</a></span>
or <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratchpad</a></span> values (depending upon your configuration)
are included:
</p>
<!-- start of list --><table class="categorytoc" width="100%" cellpadding="0" cellspacing="0" border="0">
<tr valign="top">
<td width="50%">
<ul>
<li>s_nickname</li>
<li>name</li>
<li>fname</li>
<li>lname</li>
<li>address</li>
<li>address1</li>
<li>address2</li>
</ul>
</td>
<td width="50%">
<ul>
<li>address3</li>
<li>city</li>
<li>state</li>
<li>zip</li>
<li>country</li>
<li>phone_day</li>
<li>mv_shipmode</li>
</ul>
</td>
</tr>
</table><!-- end of list -->

<p>
The first field is always the name of the variable that contains the key
for the entry.&nbsp;
The values are saved with the
<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>&nbsp;function=<a href="#set_shipping" title="&quot;set shipping&quot; heading on this page">set_shipping</a>]</span>
tag call, and are recalled with
<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>&nbsp;function=<a href="#get_shipping" title="&quot;get shipping&quot; heading on this page">get_shipping</a>]</span>.&nbsp;
A list of the available keys is kept in the &quot;<span class="fixedwidth">address_book</span>&quot; variable,
suitable for iteration and display in an HTML <span class="fixedwidth">&lt;select&gt;</span> box.&nbsp;
or as a set of links.
</p>
<p>
To get the &quot;<em>nicknames</em>&quot; assigned to the addresses,
use the <span class="fixedwidth"><a href="#get_shipping_names" title="&quot;get shipping names&quot; heading on this page">get_shipping_names</a></span> function, as follows:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping</span><span class="def_Symbol">_</span><span class="def_Syntax">names</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
By default, the retrieved <em>nicknames</em> are placed in the
&quot;<span class="fixedwidth">address_book</span>&quot; variable.&nbsp;
Here is a little snippet that builds a select box to recall shipping data:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping</span><span class="def_Symbol">_</span><span class="def_Syntax">names</span><span class="def_Symbol">]</span><br>
<br>
<span class="def_Symbol">&lt;</span><span class="def_Syntax">form action</span><span class="def_Symbol">=</span><span class="def_String">&quot;[process]&quot; </span><span class="def_Syntax">method</span><span class="def_Symbol">=</span>POST<span class="def_Symbol">&gt;</span><br>
&nbsp; &nbsp; <span class="def_Symbol">&lt;</span><span class="def_Syntax">input type</span><span class="def_Symbol">=</span><span class="def_String">&quot;hidden&quot; </span><span class="def_Syntax">name</span><span class="def_Symbol">=</span><span class="def_String">&quot;mv_session_id&quot; </span><span class="def_Syntax">value</span><span class="def_Symbol">=</span><span class="def_String">&quot;[data session id]&quot;</span><span class="def_Symbol">&gt;</span><br>
<br>
<span class="def_Symbol">[</span><span class="def_Syntax">if value address</span><span class="def_Symbol">_</span><span class="def_Syntax">book</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Symbol">&lt;</span><span class="def_Syntax">select name</span><span class="def_Symbol">=</span><span class="def_String">&quot;s_nickname&quot;</span><span class="def_Symbol">&gt;</span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="def_Symbol">[</span><span class="def_Syntax">loop arg</span><span class="def_Symbol">=</span><span class="def_String">&quot;[value address_book]&quot;</span><span class="def_Symbol">]</span><span class="def_Symbol">&lt;</span>option<span class="def_Symbol">&gt;</span><span class="def_Symbol">[</span><span class="def_Syntax">loop</span><span class="def_Symbol">-</span><span class="def_Syntax">code</span><span class="def_Symbol">]</span><span class="def_Symbol">&lt;</span><span class="def_Symbol">/</span>option<span class="def_Symbol">&gt;</span><span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">loop</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Symbol">&lt;</span><span class="def_Symbol">/</span>select<span class="def_Symbol">&gt;</span><br>
<span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">if</span><span class="def_Symbol">]</span><br>
<br>
&nbsp; &nbsp; <span class="def_Symbol">&lt;</span><span class="def_Syntax">input type</span><span class="def_Symbol">=</span><span class="def_String">&quot;submit&quot; </span><span class="def_Syntax">name</span><span class="def_Symbol">=</span><span class="def_String">&quot;mv_check&quot; </span><span class="def_Syntax">value</span><span class="def_Symbol">=</span><span class="def_String">&quot;[L]Recall shipping info[/L]&quot;</span><span class="def_Symbol">&gt;</span><br>
<span class="def_Symbol">&lt;</span><span class="def_Symbol">/</span>form<span class="def_Symbol">&gt;
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The same principle works with <em>accounts</em>, <em>carts</em> and
<em>preferences</em>.
</p>
<p>
To restore a cart, based on the above, define a
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/Form_callback_functions.html#mv_check" title="&quot;mv check&quot; heading on the &quot;Form callback functions&quot; page">mv_check</a></span>
<em>callback</em> routine, such as the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">set name</span><span class="def_Symbol">=</span><span class="def_String">&quot;[L]Recall shipping info[/L]&quot;</span><span class="def_Symbol">]</span><br>
&nbsp; &nbsp; <span class="def_Syntax">mv</span><span class="def_Symbol">_</span><span class="def_Syntax">todo</span><span class="def_Symbol">=</span>return<br>
&nbsp; &nbsp; <span class="def_Syntax">mv</span><span class="def_Symbol">_</span><span class="def_Syntax">nextpage</span><span class="def_Symbol">=</span>ord<span class="def_Symbol">/</span>basket<br>
<br>
&nbsp; &nbsp; <span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping nickname</span><span class="def_Symbol">=</span><span class="def_String">&quot;[value s_nickname]&quot;</span><span class="def_Symbol">]</span><br>
<span class="def_Symbol">[</span><span class="def_Symbol">/</span><span class="def_Syntax">set</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
When the
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/Form_callback_functions.html#mv_check" title="&quot;mv check&quot; heading on the &quot;Form callback functions&quot; page">mv_check</a></span>
<em>callback</em> is executed, the shipping address information will be
inserted into the user's session.&nbsp;
This is destructive of any current values of those user session variables,
of course.
</p>
<p>
To change the columns fields that are recalled or saved,
use the <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>]</span> tag's <span class="fixedwidth">shipping</span> parameter:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">get</span><span class="def_Symbol">_</span><span class="def_Syntax">shipping nickname</span><span class="def_Symbol">=</span><span class="def_Syntax">city</span><span class="def_Symbol">_</span><span class="def_Syntax">and</span><span class="def_Symbol">_</span><span class="def_Syntax">state shipping</span><span class="def_Symbol">=</span><span class="def_String">&quot;city state&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
Only the values of the &quot;<span class="fixedwidth">city</span>&quot; and &quot;<span class="fixedwidth">state</span>&quot; variables will be
replaced in this case.
</p>
<a name="Accounts_book"></a>
<h2>Accounts book</h2>
<p>
This refers to the <em>billing</em> address book, as opposed to the
<em>shipping</em> address book.&nbsp;
The accounts address book saves information relevant to order billing.&nbsp;
In its simplest form, this can be the only accounts book needed.&nbsp;
By default the following <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">value</a></span>, <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">cgi</a></span>
or <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratchpad</a></span> values (depending upon your configuration)
are included:
</p>
<!-- start of list --><table class="categorytoc" width="100%" cellpadding="0" cellspacing="0" border="0">
<tr valign="top">
<td width="50%">
<ul>
<li>b_nickname</li>
<li>b_name</li>
<li>b_fname</li>
<li>b_lname</li>
<li>b_address</li>
<li>b_address1</li>
<li>b_address2</li>
<li>b_address3</li>
<li>b_city</li>
</ul>
</td>
<td width="50%">
<ul>
<li>b_state</li>
<li>b_zip</li>
<li>b_country</li>
<li>b_phone</li>
<li>purchase_order</li>
<li>mv_credit_card_type</li>
<li>mv_credit_card_exp_month</li>
<li>mv_credit_card_exp_year</li>
<li>mv_credit_card_info</li>
</ul>
</td>
</tr>
</table><!-- end of list -->

<p>
The first field is always the name of the variable that contains the key
for the entry.&nbsp;
The values are saved with the
<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>&nbsp;function=<a href="#set_billing" title="&quot;set billing&quot; heading on this page">set_billing</a>]</span>
tag call, and are recalled with
<span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a>&nbsp;function=<a href="#get_billing" title="&quot;get billing&quot; heading on this page">get_billing</a>]</span>.&nbsp;
A list of the available keys is kept in the &quot;<span class="fixedwidth">accounts</span>&quot; variable,
suitable for iteration and display in an HTML <span class="fixedwidth">&lt;select&gt;</span> box.&nbsp;
or as a set of links.
</p>
<p>
See the usage examples in the <a href="#Address_book" title="&quot;Address book&quot; heading on this page">Address book</a> section,
which can be easily adapted for use with the accounts book.
</p>
<a name="Preferences"></a>
<h2>Preferences</h2>
<p>
Preferences are miscellaneous session information.&nbsp;
By default the following <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/value.html" title="value (tags)">value</a></span>, <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/cgi.html" title="cgi (tags)">cgi</a></span>
or <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/scratch.html" title="scratch (tags)">scratchpad</a></span> values (depending upon your configuration)
are included:
</p>
<!-- start of list --><table class="categorytoc" width="100%" cellpadding="0" cellspacing="0" border="0">
<tr valign="top">
<td width="50%">
<ul>
<li>email</li>
<li>fax</li>
<li>phone_night</li>
</ul>
</td>
<td width="50%">
<ul>
<li>fax_order</li>
<li>email_copy</li>
</ul>
</td>
</tr>
</table><!-- end of list -->

<p>
The <span class="fixedwidth">p_nickname</span> acts as a key to select the set of preferences.&nbsp;
You can use the following to change the values that are included in the
preferences list:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">preferences preferences</span><span class="def_Symbol">=</span><span class="def_String">&quot;email_copy email fax_order fax&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
Or in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html" title="UserDB (config)">UserDB</a></span> <em>local</em> (<span class="fixedwidth">catalog.cfg</span>)
configuration:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">UserDB&nbsp; default&nbsp; preferences&nbsp; </span><span class="def_String">&quot;mail_list email fax_order music_genre&quot;
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
See the usage examples in the <a href="#Address_book" title="&quot;Address book&quot; heading on this page">Address book</a> section,
which can be easily adapted to load and save user preferences.
</p>
<a name="Carts"></a>
<h2>Carts</h2>
<p>
The contents of shopping carts may be saved or recalled in much the same
fashion as the address book.&nbsp;
See the usage examples in the <a href="#Address_book" title="&quot;Address book&quot; heading on this page">Address book</a> section,
which can be easily adapted to load and save the cart contents.
</p>
<a name="Controlling_page_access_with_UserDB"></a>
<h2>Controlling page access with UserDB</h2>
<p>
Interchange can implement a simple access control scheme, using the
<em>userdb</em> table(s).&nbsp;
Controlled pages must reside in a directory which has an empty file
called &quot;<span class="fixedwidth">.access</span>&quot;.&nbsp;
If it is not empty then only the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/RemoteUser.html" title="RemoteUser (config)">RemoteUser</a></span> or
<span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/MasterHost.html" title="MasterHost (config)">MasterHost</a></span> may access files in that directory.
</p>
<p>
Set the following variables in your <em>local</em> configuration
(<span class="fixedwidth">catalog.cfg</span>):
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">Variable&nbsp; MV</span><span class="def_Symbol">_</span><span class="def_Syntax">USERDB</span><span class="def_Symbol">_</span><span class="def_Syntax">ACL</span><span class="def_Symbol">_</span><span class="def_Syntax">TABLE&nbsp;&nbsp; </span>userdb<br>
<span class="def_Syntax">Variable&nbsp; MV</span><span class="def_Symbol">_</span><span class="def_Syntax">USERDB</span><span class="def_Symbol">_</span><span class="def_Syntax">ACL</span><span class="def_Symbol">_</span><span class="def_Syntax">COLUMN&nbsp; </span>acl
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
The <span class="fixedwidth">MV_USERDB_ACL_TABLE</span> is the table that controls access and,
likewise, the <span class="fixedwidth">MV_USERDB_ACL_COLUMN</span> names the column which will
be checked for authorisation.
</p>
<p>
The table entry should contain the complete Interchange-style page name
of the page to be allowed.&nbsp;
It will not match substrings.
</p>
<p>
For example, if the <em>flycat</em> user followed this link:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="html_htmlUnknowParam def_ParameterUnknown def_ParameterStrong def_Parameter"><span class="def_PairStart def_Special"><span class="html_htmlTagBr def_OpenTag def_Tag">&lt;</span></span><span class="html_htmlUnknowTag def_Tag"><span class="html_htmlOpenTag def_Keyword">a</span> </span><span class="html_htmlParam def_Parameter">href</span><span class="html_htmlTagEqu def_Symbol">=</span><span class="html_htmlString def_String">&quot;[area websitecfg/master_edit]&quot;</span><span class="def_PairEnd def_Special"><span class="html_htmlTagBr def_OpenTag def_Tag">&gt;</span></span></span>Edit<span class="html_htmlUnknowParam def_ParameterUnknown def_ParameterStrong def_Parameter"><span class="def_PairStart def_Special"><span class="html_htmlTagBr def_OpenTag def_Tag">&lt;/</span></span><span class="html_htmlUnknowTag def_Tag"><span class="html_htmlOpenTag def_Keyword">a</span></span><span class="def_PairEnd def_Special"><span class="html_htmlTagBr def_OpenTag def_Tag">&gt;</span></span>
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
Access would be allowed if the content of the <em>userdb</em> entry was:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
code&nbsp; &nbsp; acl<br>
flycat&nbsp; websitecfg/master_edit
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
and disallowed if it was:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
code&nbsp; &nbsp; acl<br>
flycat&nbsp; websitecfg/master_editor
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
Access can be enabled with the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl location</span><span class="def_Symbol">=</span><span class="def_String">&quot;websitecfg/master_edit&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
And can be disabled with the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol">[</span><span class="def_Syntax">userdb function</span><span class="def_Symbol">=</span><span class="def_Syntax">set</span><span class="def_Symbol">_</span><span class="def_Syntax">acl delete</span><span class="def_Symbol">=</span><span class="def_Number">1 </span><span class="def_Syntax">location</span><span class="def_Symbol">=</span><span class="def_String">&quot;websitecfg/master_edit&quot;</span><span class="def_Symbol">]
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
Of course, a pre-existing table with the ACL values will work as well.&nbsp;
It need not be in the <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html" title="UserDB (config)">UserDB</a></span> setup.
</p>
<a name="Using_more_than_one_database_table"></a>
<h2>Using more than one database table</h2>
<p>
You can save/retrieve <em>userdb</em> information from more than one table
by using &quot;<span class="fixedwidth">outboard</span>&quot; specifier.&nbsp;
This is a comma-separated series of quoted <em>key and value</em> field
specifications.&nbsp;
For instance, if the <em>billing address</em> is to be stored in a separate
table named &quot;<span class="fixedwidth">billing</span>&quot;, you could set up the following:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">UserDB&nbsp; default outboard&nbsp; </span><span class="def_Symbol">&lt;</span><span class="def_Symbol">&lt;</span>EOU<br>
&nbsp; &nbsp; &quot;b<span class="def_Symbol">_</span><span class="def_Syntax">fname</span><span class="def_Symbol">=</span>billing<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">first</span><span class="def_Symbol">_</span><span class="def_Syntax">name</span><span class="def_Symbol">,</span><br>
&nbsp; &nbsp;&nbsp; b<span class="def_Symbol">_</span><span class="def_Syntax">lname</span><span class="def_Symbol">=</span>billing<span class="def_Symbol">:</span><span class="def_Symbol">:</span><span class="def_Syntax">last</span><span class="def_Symbol">_</span><span class="def_Syntax">name</span><span class="def_Symbol">,</span><br>
&nbsp; &nbsp;&nbsp; b<span class="def_Symbol">_</span>address1<span class="def_Symbol">=</span>billing<span class="def_Symbol">:</span><span class="def_Symbol">:</span>address1<span class="def_Symbol">,</span><br>
&nbsp; &nbsp;&nbsp; b<span class="def_Symbol">_</span>address2<span class="def_Symbol">=</span>billing<span class="def_Symbol">:</span><span class="def_Symbol">:</span>address2<span class="def_Symbol">,</span><br>
&nbsp; &nbsp;&nbsp; b<span class="def_Symbol">_</span><span class="def_Syntax">etc</span><span class="def_Symbol">=</span>billing<span class="def_Symbol">:</span><span class="def_Symbol">:</span>etc&quot;<br>
EOU
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
When the user logs in, Interchange will access the &quot;<span class="fixedwidth">first_name</span>&quot; column, in the &quot;<span class="fixedwidth">billing</span>&quot; table, to get the value of
&quot;<span class="fixedwidth">b_fname</span>&quot;.&nbsp;
When <span class="fixedwidth">[<a href="http://interchange-rtfm.pullingshots.ca/icdocs/tags/userdb.html" title="userdb (tags)">userdb</a> <a href="#save" title="&quot;save&quot; heading on this page">save</a>]</span> is used, it will be saved there as
well.&nbsp;
If you want to make the columns read-only, you can use <span class="fixedwidth"><a href="http://interchange-rtfm.pullingshots.ca/icdocs/config/UserDB.html" title="UserDB (config)">UserDB</a>
default scratch &quot;b_fname b_lname ...&quot;</span>, and the values will be
retrieved/saved from there.&nbsp;
To initialise the values for a form, you could use something like the
following after the user logs in:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Symbol"><span class="def_PairStart def_Special">[</span></span>calcn<span class="def_Symbol"><span class="def_PairEnd def_Special">]</span></span><br>
&nbsp; &nbsp; <span class="perl_Word def_Keyword">my </span><span class="perl_Var def_Var">@s_fields </span><span class="perl_Symb def_Symbol">= </span><span class="perl_WordFun perl_Word def_Keyword">grep</span><span class="def_Symbol"><span class="def_PairStart def_Special">(</span></span><span class="perl_String def_String"><span class="perl_StringEdge regexp_SpecQuote def_StringEdge def_String"><span class="def_PairStart def_Special">/</span></span><span class="regexp_SymbClass def_Var">\S</span><span class="perl_StringEdge regexp_SpecQuote def_StringEdge def_String"><span class="def_PairEnd def_Special">/</span></span></span><span class="perl_Symb def_Symbol">, </span><span class="perl_WordFun perl_Word def_Keyword">split</span><span class="def_Symbol"><span class="def_PairStart def_Special">(</span></span><span class="perl_String def_String"><span class="perl_StringEdge regexp_SpecQuote def_StringEdge def_String"><span class="def_PairStart def_Special">/</span></span><span class="regexp_Quote regexp_MetaSymb def_Symbol"><span class="def_PairStart def_Special">[</span></span><span class="regexp_SymbClass def_Var">\s</span>,<span class="regexp_Symbol def_StringContent def_String">\0</span><span class="regexp_Quote regexp_MetaSymb def_Symbol"><span class="def_PairEnd def_Special">]</span></span><span class="regexp_MetaSymb def_Symbol">+</span><span class="perl_StringEdge regexp_SpecQuote def_StringEdge def_String"><span class="def_PairEnd def_Special">/</span></span></span><span class="perl_Symb def_Symbol">, </span><span class="perl_Var def_Var">$Config</span><span class="perl_Symb def_Symbol">-&gt;</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span></span>UserDB<span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span></span><span class="perl_Symb def_Symbol">-&gt;</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span></span>scratch<span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span></span><span class="def_Symbol"><span class="def_PairEnd def_Special">)</span></span><span class="def_Symbol"><span class="def_PairEnd def_Special">)</span></span><span class="perl_MainSymb def_SymbolStrong def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="perl_Word def_Keyword">foreach </span><span class="def_Symbol"><span class="def_PairStart def_Special">(</span></span><span class="perl_Var def_Var">@s_fields</span><span class="def_Symbol"><span class="def_PairEnd def_Special">)</span> </span><span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span></span><br>
&nbsp; &nbsp; &nbsp; &nbsp; <span class="perl_Var def_Var">$Values</span><span class="perl_Symb def_Symbol">-&gt;</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span></span><span class="perl_Var def_Var">$_</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span> </span><span class="perl_Symb def_Symbol">= </span><span class="perl_Var def_Var">$Scratch</span><span class="perl_Symb def_Symbol">-&gt;</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairStart def_Special">{</span></span><span class="perl_Var def_Var">$_</span><span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span></span><span class="perl_MainSymb def_SymbolStrong def_Symbol">;</span><br>
&nbsp; &nbsp; <span class="def_SymbolStrong def_Symbol"><span class="def_PairEnd def_Special">}</span></span><br>
&nbsp; &nbsp; <span class="perl_WordFun perl_Word def_Keyword">undef</span><span class="perl_MainSymb def_SymbolStrong def_Symbol">;</span><br>
<span class="def_Symbol"><span class="def_PairStart def_Special">[</span></span>/calcn<span class="def_Symbol"><span class="def_PairEnd def_Special">]</span>
</span></span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
If the columns in the outboard table use another key, besides username,
then you can specify the column in the <span class="fixedwidth">userdb</span> that contains the
key value.&nbsp;
For example:
</p>
<!-- start of code block -->
<div class="code">
<table>
<tr>
<td class="code">
<span class="fixedwidth">
<span class="def_Syntax">UserDB&nbsp; default&nbsp; outboard</span><span class="def_Symbol">_</span><span class="def_Syntax">key</span><span class="def_Symbol">_</span><span class="def_Syntax">col&nbsp; account</span><span class="def_Symbol">_</span>id
</span>
</td>
</tr>
</table>
</div>
<!-- end of code block -->
<p>
</div>

<!-- start of modification notice -->
<div class="wikitext">
    <table class="pageinfo" cellpadding="0" cellspacing="0">
	<tr>
	    <td>
Category:&nbsp; <a href="http://interchange-rtfm.pullingshots.ca/icdocs/category:Interchange_database.html">Interchange database</a>
	    </td>
	</tr>


	<tr>
	    <td>
		
		Last modified by: <a href="http://interchange-rtfm.pullingshots.ca/account/profile.html?user=thunder">Gert van der Spoel</a><br>
		Modification date: Saturday 26 January 2008 at 8:02 PM (GMT)
	    </td>
	</tr>
    </table>
</div>
<!-- end of modification notice -->



<!-- end page: wiki/display (Interchange_user_database) -->



<!-- end of page text -->
	    </td>

	</tr>
    </table>
<!-- START VAR: FOOTER -->

<table id="rtfmfooter" width="100%" cellpadding="0" cellspacing="0">
    <tr>
	<td>
	    <a href="http://interchange-rtfm.pullingshots.ca/index.html">Home</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/legal/legal.html">Legal nonsense</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/legal/privacy.html">Privacy policy</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/donations.html">Donations</a>
	    &nbsp;|&nbsp;
	    <a href="http://interchange-rtfm.pullingshots.ca/contact.html">Contact us</a>
	</td>

    </tr>
</table>

<!-- END VAR: FOOTER -->

<!-- START VAR: COPYRIGHT -->


    <div class="copyright">
	Copyright &copy; 2001-2016
	<a href="http://cursor.biz/index.html">Cursor Software Limited</a>.&nbsp;
	All Rights Reserved.
    </div>

<!-- END VAR: COPYRIGHT -->

</body>
</html>
